# backend/src/main/resources/application.properties

# =================================================================
# AI财务管理系统 - 配置文件
# 支持ORM和DDD两种架构模式
# =================================================================

# Database Configuration
spring.datasource.url=jdbc:mysql://localhost:3306/testdb?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.password=510418excmikeMS!
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA Configuration - 基础配置
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.database=mysql
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# 重要：移除静态实体扫描配置，改为Profile动态配置
# spring.jpa.hibernate.exclude-packages=org.example.backend.domain.aggregate

# JWT Configuration
jwt.secret=${JWT_SECRET:AI-Finance-System-Secret-Key-2024}
jwt.expiration=3600000

# Microsoft SSO Configuration
sso.client-id=${SSO_CLIENT_ID:dummy}
sso.client-secret=${SSO_CLIENT_SECRET:dummy}
sso.token-url=https://login.microsoftonline.com/common/oauth2/v2.0/token
sso.user-info-url=https://graph.microsoft.com/oidc/userinfo
sso.redirect-uri=http://localhost:3000/api/auth/sso/callback

# Server Configuration
server.port=8085
server.servlet.context-path=/

# =================================================================
# Profile 模式配置
# =================================================================
# 默认使用ORM模式，可通过参数切换到DDD模式
spring.profiles.active=orm

# DDD Feature Flags
ddd.enabled=false
migration.enabled=false
migration.preserve-ids=true

# =================================================================
# Logging Configuration
# =================================================================
logging.level.org.example.backend=INFO
logging.level.org.springframework.boot=INFO
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN

# Profile相关日志
logging.level.org.example.backend.config.ProfileBasedConfiguration=DEBUG

# =================================================================
# 开发环境配置
# =================================================================
# 显示更详细的错误信息
server.error.include-message=always
server.error.include-binding-errors=always

# 禁用缓存以便开发调试
spring.thymeleaf.cache=false
spring.resources.cache.period=0

# =================================================================
# 模式切换说明
# =================================================================
# 切换到ORM模式：
# SPRING_PROFILES_ACTIVE=orm ./mvnw spring-boot:run
# 
# 切换到DDD模式：
# SPRING_PROFILES_ACTIVE=ddd ./mvnw spring-boot:run
# 
# 运行数据迁移（DDD模式）：
# SPRING_PROFILES_ACTIVE=ddd ./mvnw spring-boot:run -Dmigration.enabled=true