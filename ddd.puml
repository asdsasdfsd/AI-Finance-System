@startuml
!define RECTANGLE class

package "Accounting Context" {
  RECTANGLE Company {
    +companyId: Integer <<PK>>
    +name: String
    +city: String
    +stateProvince: String
    +email: String
    +website: String
    +registerationNumber: String
    +taxId: String
    +fiscalYearStart: String
    +defaultCurrency: String
    +status: String
    +createdAt: DateTime
    +updatedAt: DateTime
  }
  RECTANGLE User {
    +userId: Integer <<PK>>
    +companyId: Integer <<FK>>
    +email: String
    +fullName: String
    +isActive: Boolean
    +isExternal: Boolean
    +externalId: String
    +createdAt: DateTime
    +updatedAt: DateTime
  }
  RECTANGLE Account {
    +accountId: Integer <<PK>>
    +companyId: Integer <<FK>>
    +name: String
    +accountType: String
    +parentAccountId: Integer <<FK>>
    +balance: Decimal
    +currency: String
    +isActive: Boolean
    +createdAt: DateTime
    +updatedAt: DateTime
  }
  RECTANGLE JournalEntry {
    +entryId: Integer <<PK>>
    +companyId: Integer <<FK>>
    +reference: String
    +description: String
    +fiscalPeriodId: Integer <<FK>>
    +status: String
    +createdAt: DateTime
    +updatedAt: DateTime
  }
  RECTANGLE Transaction {
    +transactionId: Integer <<PK>>
    +userId: Integer <<FK>>
    +companyId: Integer <<FK>>
    +departmentId: Integer <<FK>>
    +fundId: Integer <<FK>>
    +accountId: Integer <<FK>>
    +categoryId: Integer <<FK>>
    +amount: Decimal
    +currency: String
    +transactionType: String
    +date: Date
    +description: String
    +paymentMethod: String
    +referenceNumber: String
    +isRecurring: Boolean
    +isTaxable: Boolean
    +createdAt: DateTime
    +updatedAt: DateTime
  }
}

package "Value Objects" {
  RECTANGLE Category {
    +categoryId: Integer <<PK>>
    +companyId: Integer <<FK>>
    +name: String
    +type: Enum
    +parentCategoryId: Integer <<FK>>
    +isActive: Boolean
    +createdAt: DateTime
    +updatedAt: DateTime
  }
  RECTANGLE Fund {
    +fundId: Integer <<PK>>
    +companyId: Integer <<FK>>
    +name: String
    +description: String
    +fundType: String
    +balance: Decimal
    +isActive: Boolean
    +createdAt: DateTime
    +updatedAt: DateTime
  }
  RECTANGLE Period {
    +fiscalPeriodId: Integer <<PK>>
    +companyId: Integer <<FK>>
    +startDate: Date
    +endDate: Date
    +entryCount: Integer
    +status: Enum
    +createdAt: DateTime
    +updatedAt: DateTime
  }
}

package "Department & Budget" {
  RECTANGLE Department {
    +departmentId: Integer <<PK>>
    +companyId: Integer <<FK>>
    +name: String
    +parentDepartmentId: Integer <<FK>>
    +managerId: Integer <<FK>>
    +budget: Decimal
    +isActive: Boolean
    +createdAt: DateTime
    +updatedAt: DateTime
  }
  RECTANGLE Budget {
    +budgetId: Integer <<PK>>
    +departmentId: Integer <<FK>>
    +amount: Decimal
    +currency: String
    +fiscalPeriodId: Integer <<FK>>
    +status: Enum
    +createdAt: DateTime
    +updatedAt: DateTime
  }
}

package "Identity Context" {
  RECTANGLE Role {
    +roleId: Integer <<PK>>
    +name: String
    +description: String
  }
  RECTANGLE UserRole {
    +userId: Integer <<FK>>
    +roleId: Integer <<FK>>
  }
}

' 聚合间关系
Company "1" -- "0..*" Account : manages >
Company "1" -- "0..*" User : employs >
Account "1" -- "0..*" JournalEntry : belongs to >
JournalEntry "1" -- "1..*" Transaction : consists of >
Transaction "1" -- "1" Category : is
Company "1" -- "0..*" Fund : owns >
Transaction "1" -- "1" Fund : affects >
User "0..*" -- "1..*" Role : has >
User "1" -- "0..*" UserRole : assigns >

@enduml
